<app-page-header>График курсов валют</app-page-header>

<div class="container my-5">
  <div class="card">
    <div class="card-body p-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h5 class="mb-1">Динамика курсов валют</h5>
          <p class="text-muted mb-0 small">
            Средние значения курсов валют по неделям относительно KZT
          </p>
        </div>
        <button
          class="btn btn-sm btn-outline-secondary"
          (click)="refresh()"
          [disabled]="isLoading"
        >
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
          Обновить
        </button>
      </div>

      <!-- Loading state -->
      <div *ngIf="isLoading" class="text-center py-5">
        <app-data-loader></app-data-loader>
      </div>

      <!-- Error state -->
      <div *ngIf="errorMessage && !isLoading" class="alert alert-danger">
        {{ errorMessage }}
      </div>

      <!-- No data state -->
      <div
        *ngIf="!isLoading && !errorMessage && chartData && chartData.length === 0"
        class="text-center py-5"
      >
        <div class="text-muted mb-3">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="64"
            height="64"
            fill="currentColor"
            viewBox="0 0 16 16"
          >
            <path
              d="M4 11H2v3h2zm5-4H7v7h2zm5-5h-2v12h2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1z"
            />
          </svg>
        </div>
        <p class="text-muted">Нет данных для отображения графика</p>
      </div>

      <!-- Chart -->
      <div
        *ngIf="!isLoading && !errorMessage && chartData && chartData.length > 0"
        class="chart-container"
      >
        <canvas [id]="canvasId">{{ chart }}</canvas>
      </div>

      <!-- Legend info -->
      <div
        *ngIf="!isLoading && !errorMessage && chartData && chartData.length > 0"
        class="mt-4"
      >
        <div class="small text-muted">
          <strong>Примечание:</strong> График показывает средние курсы валют за
          каждую неделю. Нажмите на название валюты в легенде, чтобы
          скрыть/показать соответствующую линию.
        </div>
      </div>
    </div>
  </div>
</div>
