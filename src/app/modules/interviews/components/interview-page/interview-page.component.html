<app-page-header>
  {{ pageTitle }}
</app-page-header>

<div *ngIf="interview; else dataLoading" class="container mx-auto mt-5">
  <div class="flex flex-wrap">
    <div class="w-full sm:w-1/4">
      <div class="bg-white rounded-lg shadow">
        <div class="p-6">
          <ul class="divide-y divide-gray-200">
            <li class="px-4 py-3 border-0">
              <app-go-back-button></app-go-back-button>
            </li>

            <li class="px-4 py-3 border-0">
              <div class="text-gray-500 text-sm">Интервью провел</div>
              <div class="text-sm">
                {{ interview.interviewer?.email }}
              </div>
            </li>
            <li class="px-4 py-3 border-0">
              <div class="text-gray-500 text-sm">Кандидат</div>
              <div class="text-sm">
                {{ interview.candidateName }}
              </div>
            </li>
            <li class="px-4 py-3 border-0">
              <div class="text-gray-500 text-sm">Грейд</div>
              <div class="">
                <app-developer-grade-label
                  [grade]="interview.candidateGrade"
                ></app-developer-grade-label>
              </div>
            </li>
            <li class="px-4 py-3 border-0">
              <div class="text-gray-500 text-sm">Тем</div>
              <div>
                {{ interview.subjects?.length ?? 0 }}
              </div>
            </li>
            <li class="px-4 py-3 border-0" *ngIf="interview.labels.length > 0">
              <div class="text-gray-500 text-sm">Тэги</div>
              <div>
                <app-label
                  *ngFor="let item of interview.labels"
                  [label]="item"
                ></app-label>
              </div>
            </li>
            <li class="px-4 py-3 border-0">
              <div class="text-gray-500 text-sm">Обновлено</div>
              <div>
                {{ interview.updatedAt | date: "yyyy-MM-dd HH:mm" }}
              </div>
            </li>
            <li class="px-4 py-3 border-0">
              <div class="text-gray-500 text-sm">Экспорт</div>
              <div>
                <app-loading-button
                  [css]="
                    'border border-gray-800 text-gray-800 text-xs px-2 py-1 rounded hover:bg-gray-100 ml-1'
                  "
                  (clicked)="markdownFromServer()"
                >
                  Markdown
                </app-loading-button>
                <app-loading-button
                  [css]="
                    'border border-gray-800 text-gray-800 text-xs px-2 py-1 rounded hover:bg-gray-100 ml-1'
                  "
                  (clicked)="exportAsPDF()"
                >
                  PDF
                </app-loading-button>
              </div>
            </li>
            <li class="px-4 py-3 border-0">
              <div class="text-gray-500 text-sm">Действия</div>
              <div>
                <a
                  routerLink="/interviews/{{ interview.id }}/edit"
                  class="btn-link-sm"
                  title="Edit interview"
                  >Редактировать</a
                >
                <button
                  type="button"
                  class="btn-link-sm btn-link-danger ml-1"
                  title="Delete interview"
                  (click)="delete()"
                >
                  Удалить
                </button>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="w-full sm:w-3/4">
      <div class="bg-white rounded-lg shadow">
        <div class="p-6">
          <div class="mb-3" *ngIf="interview && interview.overallOpinion">
            <div>
              <markdown>{{ interview.overallOpinion }}</markdown>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow mt-3">
        <div class="p-6">
          <ul
            class="divide-y divide-gray-200"
            *ngIf="
              interview && interview.subjects && interview.subjects.length > 0;
              noSubjectsYet
            "
          >
            <li
              class="px-4 py-3 border-0"
              *ngFor="let item of interview.subjects; let i = index"
            >
              <div class="flex justify-between">
                <div class="inline-block">
                  <span class="text-gray-500 text-sm">{{ i + 1 }}.</span
                  ><strong class="ml-1">{{ item.title }}</strong>
                </div>
                <span
                  ><app-developer-grade-label
                    [grade]="item.grade"
                  ></app-developer-grade-label
                ></span>
              </div>
              <div class="pl-3 text-sm" *ngIf="item.comments">
                <markdown>{{ item.comments }}</markdown>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #noSubjectsYet>
  <div class="bg-white rounded-lg shadow">
    <div class="p-6 text-center">
      <span class="h4">No subjects were discussed</span>
    </div>
  </div>
</ng-template>

<ng-template #dataLoading>
  <div class="container mx-auto mt-5">
    <app-data-loader></app-data-loader>
  </div>
</ng-template>

<app-confirm-dialog
  *ngIf="confirmDeletionMessage"
  [message]="confirmDeletionMessage"
></app-confirm-dialog>

<app-interview-markdown-modal-dialog
  *ngIf="interviewMarkdownContent"
  [show]="showMarkdownContentModal"
  [interview]="interviewMarkdownContent"
  (closed)="showMarkdownContentModal = !showMarkdownContentModal"
>
</app-interview-markdown-modal-dialog>
